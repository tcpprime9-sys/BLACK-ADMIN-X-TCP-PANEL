<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLACK ADMIN X TCP PANEL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-orange: #f97316;
            --neon-blue: #00f3ff;
            --neon-green: #4ade80;
            --neon-red: #f87171;
        }
        body { background-color: #050505; font-family: 'Rajdhani', sans-serif; color: #ffffff; overflow-x: hidden; }
        
        /* RGB Border Animation */
        @keyframes rgb-glow {
            0% { border-color: var(--neon-orange); box-shadow: 0 0 5px var(--neon-orange); }
            33% { border-color: var(--neon-blue); box-shadow: 0 0 5px var(--neon-blue); }
            66% { border-color: var(--neon-green); box-shadow: 0 0 5px var(--neon-green); }
            100% { border-color: var(--neon-orange); box-shadow: 0 0 5px var(--neon-orange); }
        }

        .card-bg { 
            background: rgba(22, 22, 22, 0.8); 
            border-radius: 15px; 
            border: 1px solid #252525; 
            margin-bottom: 12px; 
            backdrop-filter: blur(10px);
            transition: 0.3s;
        }
        .card-bg:hover { animation: rgb-glow 3s infinite linear; }

        .sidebar { position: fixed; left: -100%; top: 0; width: 280px; height: 100%; background: #0f0f11; z-index: 1000; transition: 0.4s; border-right: 2px solid var(--neon-orange); box-shadow: 5px 0 15px rgba(249, 115, 22, 0.2); }
        .sidebar.active { left: 0; }
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 999; backdrop-filter: blur(4px); }
        .overlay.active { display: block; }

        .btn-op { padding: 10px; border-radius: 8px; font-weight: bold; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 5px; transition: 0.3s; width: 100%; text-transform: uppercase; letter-spacing: 1px; }
        .btn-start { background: rgba(13, 46, 33, 0.5); color: #4ade80; border: 1px solid #14532d; }
        .btn-start:hover { background: #14532d; box-shadow: 0 0 15px var(--neon-green); }
        .btn-stop { background: rgba(36, 22, 22, 0.5); color: #f87171; border: 1px solid #451a1a; }
        .btn-stop:hover { background: #451a1a; box-shadow: 0 0 15px var(--neon-red); }
        .btn-restart { background: rgba(61, 38, 30, 0.5); color: #fb923c; border: 1px solid #7c2d12; }
        .btn-restart:hover { background: #7c2d12; box-shadow: 0 0 15px #fb923c; }
        .btn-force { background: #2d1a1a; color: #fca5a5; border: 1px solid #451a1a; }
        .btn-util { background: #1a1a1c; color: #94a3b8; border: 1px solid #333; }
        .btn-util:hover { border-color: var(--neon-blue); color: var(--neon-blue); }

        #toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background: #111; padding: 12px 25px; border-radius: 30px; border: 2px solid var(--neon-orange); z-index: 2000; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); color: var(--neon-orange); font-size: 13px; font-weight: bold; box-shadow: 0 0 20px rgba(249, 115, 22, 0.4); }
        #toast.show { top: 40px; }

        .active-tab { color: var(--neon-orange) !important; background: rgba(249, 115, 22, 0.1); border-left: 4px solid var(--neon-orange); box-shadow: inset 5px 0 10px rgba(249, 115, 22, 0.05); }
        .console-box { background: #000; border-radius: 0 0 15px 15px; padding: 15px; height: 300px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 11px; color: #00ff00; border-top: 1px solid #252525; scroll-behavior: smooth; }
        .icon-box { background: #1a1a1c; width: 45px; height: 45px; border-radius: 10px; border: 1px solid #333; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        
        input, select { background: #0a0a0c !important; border: 1px solid #252525 !important; color: white !important; outline: none; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--neon-orange) !important; box-shadow: 0 0 10px rgba(249, 115, 22, 0.2); }

        .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #333; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #15803d; box-shadow: 0 0 10px #15803d; }
        input:checked + .slider:before { transform: translateX(14px); }

        .rgb-text { background: linear-gradient(90deg, #f97316, #00f3ff, #4ade80); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #0d0d0d; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neon-orange); }
    </style>
</head>
<body>

    <div id="toast">SYSTEM ONLINE BY BLACK ADMIN X</div>
    <div id="overlay" class="overlay" onclick="toggleMenu()"></div>

    <div id="sidebar" class="sidebar p-6">
        <div class="flex items-center gap-3 mb-10 border-b border-white/5 pb-4">
            <span class="text-orange-500 text-3xl animate-pulse">ü§ñ</span>
            <h1 class="text-2xl font-bold">BLACK ADMIN X TCP</h1>
        </div>
        <nav class="space-y-4">
            <div onclick="showPage('control')" class="p-4 rounded-xl active-tab cursor-pointer transition-all" id="m-control">üéÆ Control Panel</div>
            <div onclick="showPage('accounts')" class="p-4 rounded-xl text-gray-400 cursor-pointer hover:bg-white/5" id="m-accounts">üë• Accounts</div>
            <div onclick="showPage('friends')" class="p-4 rounded-xl text-gray-400 cursor-pointer hover:bg-white/5" id="m-friends">üë§ Friends</div>
            <div onclick="showPage('clan')" class="p-4 rounded-xl text-gray-400 cursor-pointer hover:bg-white/5" id="m-clan">üõ°Ô∏è Clan Search</div>
            <div onclick="showPage('admin')" class="p-4 rounded-xl text-gray-400 cursor-pointer hover:bg-white/5" id="m-admin">üõ†Ô∏è Admin Panel</div>
        </nav>
    </div>

    <header class="p-5 flex justify-between items-center sticky top-0 z-50 bg-[#0d0d0d]/90 backdrop-blur-md border-b border-white/5">
        <div class="flex items-center gap-4">
            <button onclick="toggleMenu()" class="text-2xl text-orange-500 hover:scale-110 transition">‚ò∞</button>
            <h1 id="page-title" class="text-xl font-bold flex items-center gap-2 tracking-tighter uppercase">‚ö° Control Panel</h1>
        </div>
        <div class="bg-[#1a1a1c] p-2 px-4 rounded-xl text-[10px] font-bold border border-orange-500/30 text-orange-500 uppercase tracking-widest shadow-[0_0_10px_rgba(249,115,22,0.1)]">
            BLACK ADMIN X TCP PANEL
        </div>
    </header>

    <main class="p-4 max-w-xl mx-auto">
        
        <div id="page-control" class="space-y-3">
            <div class="card-bg p-4 flex justify-between items-center group">
                <div>
                    <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Bot Status</p>
                    <span id="stext" class="text-red-500 text-xs font-bold uppercase">Stopped</span>
                </div>
                <div class="icon-box text-red-500 text-xl group-hover:rotate-12">üó£Ô∏è</div>
            </div>

            <div class="card-bg p-4 flex justify-between items-center group">
                <div>
                    <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Uptime</p>
                    <h3 id="timer-display" class="text-xl font-bold font-mono">0h 0m 0s</h3>
                </div>
                <div class="icon-box text-cyan-500 text-xl group-hover:scale-110">üïí</div>
            </div>

            <div class="card-bg overflow-hidden shadow-2xl">
                <div class="p-4 border-b border-white/5 flex justify-between items-center bg-white/5">
                    <h3 class="text-xs font-bold uppercase tracking-widest">üéÆ Bot Operations</h3>
                    <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                </div>
                <div class="p-4 grid grid-cols-3 gap-2">
                    <button onclick="control('start')" class="btn-op btn-start">‚ñ∂ Start</button>
                    <button onclick="control('stop')" class="btn-op btn-stop">‚ñ† Stop</button>
                    <button onclick="control('restart')" class="btn-op btn-restart">üîÑ Restart</button>
                </div>
                <div class="px-4 pb-4 grid grid-cols-3 gap-2">
                    <button onclick="msg('FORCE KILL SENT')" class="btn-op btn-force">üö´ Force Kill</button>
                    <button onclick="document.getElementById('logs').innerHTML=''" class="btn-op btn-util">üóë Clear</button>
                    <button onclick="msg('AUTO SCROLL ENABLED')" class="btn-op btn-util">‚Üï Scroll</button>
                </div>
                <div id="logs" class="console-box">Console Initialized...</div>
            </div>
        </div>

        <div id="page-accounts" class="hidden space-y-4">
            <div class="card-bg p-6 border-t-2 border-orange-500">
                <h3 class="text-orange-500 font-bold mb-4 uppercase text-xs tracking-widest">Account Setup</h3>
                <input id="name" type="text" placeholder="Bot Nickname" class="w-full p-4 rounded-xl mb-3 outline-none">
                <input id="uid" type="text" placeholder="Player UID" class="w-full p-4 rounded-xl mb-3 outline-none">
                <input id="pw" type="password" placeholder="Password" class="w-full p-4 rounded-xl mb-4 outline-none">
                <button onclick="saveAcc()" class="btn-op bg-orange-600 text-white p-4 hover:bg-orange-500 shadow-lg shadow-orange-900/20">SAVE CONFIGURATION</button>
            </div>
        </div>

        <div id="page-friends" class="hidden space-y-4">
            <div class="card-bg p-6 border-t-2 border-cyan-500">
                <div class="flex gap-2 mb-4 bg-black p-1 rounded-xl border border-white/5">
                    <button onclick="tabFriend('check')" id="tab-check" class="flex-1 py-2 rounded-lg bg-orange-600 text-xs font-bold transition-all">LIST</button>
                    <button onclick="tabFriend('add')" id="tab-add" class="flex-1 py-2 rounded-lg text-gray-500 text-xs font-bold transition-all">ADD</button>
                </div>
                <div id="sec-check" class="space-y-3">
                    <button onclick="fetchFriendList()" class="w-full bg-cyan-600/10 text-cyan-400 p-4 rounded-xl text-xs font-bold border border-cyan-900/20 hover:bg-cyan-600/20 transition">FETCH LIST</button>
                    <div id="nickname-list" class="grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-1"></div>
                </div>
                <div id="sec-add" class="hidden space-y-3">
                    <input id="target-uid" type="text" placeholder="Target UID" class="w-full p-4 rounded-xl outline-none border border-white/5">
                    <button onclick="addFriend()" class="btn-op bg-orange-600 text-white hover:bg-orange-500">SEND REQUEST</button>
                </div>
            </div>
        </div>

        <div id="page-clan" class="hidden space-y-4">
            <div class="card-bg p-6 border-t-2 border-green-500">
                <h3 class="text-orange-500 font-bold mb-4 uppercase text-xs tracking-widest">üõ°Ô∏è Clan Search</h3>
                <div class="space-y-3">
                    <input id="guild-id" type="text" placeholder="Enter Guild ID" class="w-full p-4 rounded-xl outline-none">
                    <select id="region" class="w-full p-4 rounded-xl text-sm outline-none">
                        <option value="bd">Bangladesh (BD)</option>
                        <option value="ind">India (IND)</option>
                        <option value="sg">Singapore (SG)</option>
                        <option value="br">Brazil (BR)</option>
                        <option value="id">Indonesia (ID)</option>
                        <option value="th">Thailand (TH)</option>
                        <option value="vn">Vietnam (VN)</option>
                        <option value="me">Middle East (ME)</option>
                        <option value="pk">Pakistan (PK)</option>
                        <option value="na">North America (NA)</option>
                        <option value="sac">South America (SAC)</option>
                        <option value="eu">Europe (EU)</option>
                        <option value="ru">Russia (RU)</option>
                        <option value="tw">Taiwan (TW)</option>
                    </select>

                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="guildApi('info')" class="btn-op btn-util">INFO</button>
                        <button onclick="guildApi('members')" class="btn-op btn-util">MEMBERS</button>
                        <button onclick="guildApi('join')" class="btn-op btn-util text-green-500 border-green-900/50 hover:bg-green-500/10">JOIN</button>
                        <button onclick="guildApi('leave')" class="btn-op btn-util text-red-500 border-red-900/50 hover:bg-red-500/10">LEAVE</button>
                    </div>
                </div>
            </div>
            <div id="clan-result" class="card-bg p-4 min-h-[100px] text-xs overflow-y-auto font-mono text-gray-400"></div>
        </div>

        <div id="page-admin" class="hidden space-y-4">
    <div class="card-bg p-6 border-t-2 border-purple-500">
        <h3 class="text-orange-500 font-bold mb-4 uppercase text-xs tracking-widest">üõ†Ô∏è Master Admin Panel</h3>
        
        <div id="admin-login-sec">
            <input id="adm-pw" type="password" placeholder="Admin Passkey" class="w-full p-4 rounded-xl mb-3 text-center border border-white/5 tracking-widest">
            <button onclick="adminAction('login')" class="btn-op bg-white/5 text-orange-500 border border-orange-500/30 hover:bg-orange-500/10">LOGIN ADMIN</button>
        </div>

        <div id="admin-config-sec" class="hidden space-y-5">
            <div class="p-4 bg-black rounded-2xl border border-white/5 relative overflow-hidden">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-[9px] text-gray-500 uppercase">Global Duration (Min)</p>
                    <p class="text-[10px] text-cyan-500 font-bold">Active: <span id="current-global-time">--</span>m</p>
                </div>
                <div class="flex gap-2">
                    <input id="new-duration" type="number" placeholder="Enter minutes" class="w-2/3 rounded-lg p-2 text-xs">
                    <button onclick="saveGlobal()" class="w-1/3 bg-orange-600 rounded-lg text-[10px] font-bold shadow-lg shadow-orange-900/30">SET</button>
                </div>
            </div>
            
            <p class="text-[10px] text-orange-500 font-bold uppercase px-1">Manage Users</p>
            <div id="active-user-list" class="space-y-2 max-h-60 overflow-y-auto pr-1"></div>
        </div>
    </div>
</div>


    </main>

    <script>
        const socket = io();
        let countdown;

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        function showPage(p) {
            ['control', 'accounts', 'friends', 'clan', 'admin'].forEach(pg => {
                const page = document.getElementById('page-'+pg);
                if(page) page.classList.add('hidden');
                const menu = document.getElementById('m-'+pg);
                if(menu) menu.classList.remove('active-tab');
            });
            const activePage = document.getElementById('page-'+p);
            if(activePage) activePage.classList.remove('hidden');
            const activeMenu = document.getElementById('m-'+p);
            if(activeMenu) activeMenu.classList.add('active-tab');
            
            document.getElementById('page-title').innerText = '‚ö° ' + p.toUpperCase().replace('CONTROL', 'Control Panel').replace('CLAN', 'Clan Search').replace('ADMIN', 'Admin Panel');
            if(window.innerWidth < 1024 && document.getElementById('sidebar').classList.contains('active')) toggleMenu();
        }

        function tabFriend(type) {
            document.getElementById('sec-check').classList.toggle('hidden', type !== 'check');
            document.getElementById('sec-add').classList.toggle('hidden', type !== 'add');
            document.getElementById('tab-check').className = type === 'check' ? "flex-1 py-2 rounded-lg bg-orange-600 text-xs font-bold" : "flex-1 py-2 rounded-lg text-gray-500 text-xs font-bold";
            document.getElementById('tab-add').className = type === 'add' ? "flex-1 py-2 rounded-lg bg-orange-600 text-xs font-bold" : "flex-1 py-2 rounded-lg text-gray-500 text-xs font-bold";
        }

        function msg(t) {
            const e = document.getElementById('toast'); e.innerText = t; e.classList.add('show');
            setTimeout(() => e.classList.remove('show'), 3000);
        }

        function saveAcc() {
            const name = document.getElementById('name').value, uid = document.getElementById('uid').value, pw = document.getElementById('pw').value;
            if(!name || !uid || !pw) return msg("FILL ALL FIELDS!");
            localStorage.setItem('bot_name', name); localStorage.setItem('bot_uid', uid); localStorage.setItem('bot_pw', pw);
            msg("CONFIGURATION SAVED!");
        }

        async function control(act) {
            const name = localStorage.getItem('bot_name'), uid = localStorage.getItem('bot_uid'), pw = localStorage.getItem('bot_pw');
            if(!name) return msg("SETUP NAME FIRST!");
            try {
                const res = await fetch('/api/control', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({action: act, name, uid, password: pw}) });
                const d = await res.json(); msg(d.message);
                if(d.status === 'success') updateStat(d.running, d.rem_sec);
            } catch(e) { msg("SERVER ERROR"); }
        }

        function updateStat(run, rem = 0) {
            const el = document.getElementById('stext');
            el.innerText = run ? "Running" : "Stopped";
            el.className = run ? "text-green-500 text-xs font-bold uppercase shadow-[0_0_10px_rgba(74,222,128,0.2)]" : "text-red-500 text-xs font-bold uppercase";
            if(run) startTimer(Math.floor(rem));
            else { clearInterval(countdown); document.getElementById('timer-display').innerText = "0h 0m 0s"; }
        }

        function startTimer(sec) {
            clearInterval(countdown);
            if(sec <= 0 && sec !== -1) return;
            function update() {
                if(sec === -1) { document.getElementById('timer-display').innerText = "Unlimited"; return; }
                if(sec <= 0) { clearInterval(countdown); updateStat(false); return; }
                let h = Math.floor(sec / 3600), m = Math.floor((sec % 3600) / 60), s = sec % 60;
                document.getElementById('timer-display').innerText = `${h}h ${m}m ${s}s`;
                sec--;
            }
            update(); countdown = setInterval(update, 1000);
        }

        async function guildApi(type) {
            const gid = document.getElementById('guild-id').value, 
                  reg = document.getElementById('region').value, 
                  uid = localStorage.getItem('bot_uid'), 
                  pw = localStorage.getItem('bot_pw'), 
                  resBox = document.getElementById('clan-result');

            if(!gid) return msg("ENTER GUILD ID!");
            resBox.innerHTML = "<p class='animate-pulse text-center mt-4 text-orange-500 font-mono'>[SYSTEM] FETCHING CLAN DATA...</p>";

            try {
                const response = await fetch(`/api/proxy_guild?type=${type}&guild_id=${gid}&region=${reg}&uid=${uid}&password=${pw}`);
                const data = await response.json();

                if(type === 'info') {
                    resBox.innerHTML = `
                        <div class='text-center p-2 border border-white/5 rounded-xl bg-black/50'>
                            <p class='text-[10px] text-gray-500 uppercase tracking-widest mb-1'>Clan Name</p>
                            <h2 class='text-lg font-bold text-white rgb-text'>${data.guild_name || data.name || 'N/A'}</h2>
                            <div class='flex justify-center gap-4 mt-2'>
                                <span class='text-orange-500 font-bold'>LVL: ${data.guild_level || data.level || 0}</span>
                                <span class='text-cyan-500 font-bold'>Glory: ${data.guild_glory || data.glory || 0}</span>
                            </div>
                        </div>`;
                } 
                else if(type === 'members') {
                    const members = data.members || data.member_list || data.list;
                    if(!members || members.length === 0) {
                        resBox.innerHTML = "<p class='text-center text-gray-500 py-4'>No members found or API error.</p>";
                        return;
                    }
                    let h = `<div class='overflow-x-auto'><table class='w-full text-[10px] text-left border-collapse'>
                        <thead><tr class='text-gray-500 border-b border-white/10'><th class='pb-2 pl-1'>NAME</th><th class='pb-2 text-center'>LVL</th><th class='pb-2 text-right pr-1'>GLORY</th></tr></thead>
                        <tbody class='divide-y divide-white/5'>`;
                    members.forEach((m) => {
                        const name = m.nickname || m.name || m.userName || "Unknown";
                        const lvl = m.level || m.lvl || m.player_level || "0";
                        const glory = m.glory || m.member_glory || m.point || "0";
                        h += `<tr class='hover:bg-white/5 transition'><td class='py-2 font-bold text-gray-300 truncate max-w-[100px]'>${name}</td><td class='py-2 text-center text-cyan-400'>${lvl}</td><td class='py-2 text-right text-orange-500'>${glory}</td></tr>`;
                    });
                    h += `</tbody></table></div>`;
                    resBox.innerHTML = h;
                } 
                else {
                    resBox.innerHTML = `<div class='text-center text-green-500 font-bold uppercase p-4'>${type} SUCCESSFUL</div>`;
                    msg(`${type.toUpperCase()} COMMAND EXECUTED!`);
                }
            } catch (e) { 
                resBox.innerHTML = "<p class='text-center text-red-500 py-4 font-mono'>[ERROR] API REQUEST FAILED</p>"; 
            }
        }

        async function adminAction() {
            const pass = document.getElementById('adm-pw').value;
            try {
                const res = await fetch('/api/admin', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({action: 'login', password: pass}) });
                const d = await res.json();
                if(d.status === 'success') {
                    document.getElementById('admin-login-sec').classList.add('hidden');
                    document.getElementById('admin-config-sec').classList.remove('hidden');
                    if(d.global_duration) document.getElementById('current-global-time').innerText = d.global_duration;
                    renderActiveUsers(d.users);
                } else msg("INVALID PASSKEY!");
            } catch(e) { msg("AUTH FAILED"); }
        }

        function renderActiveUsers(users) {
            const container = document.getElementById('active-user-list');
            container.innerHTML = users.length === 0 ? '<p class="text-[10px] text-gray-500 italic text-center py-4">No Active User Sessions</p>' : '';
            users.forEach(u => {
                container.innerHTML += `
                <div class="flex justify-between items-center bg-white/5 p-3 rounded-xl border border-white/5 hover:border-white/10 transition">
                    <div>
                        <p class="text-[11px] font-bold text-gray-200">${u.name}</p>
                        <p class="text-[9px] text-cyan-500 font-mono">${u.rem_min} min left</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editUserTime('${u.name}')" class="bg-cyan-600/20 text-cyan-400 px-2 py-1 rounded text-[9px] font-bold border border-cyan-900/30 hover:bg-cyan-600/40">TIME</button>
                        <button onclick="stopUserBot('${u.name}')" class="bg-red-600/20 text-red-500 px-2 py-1 rounded text-[9px] font-bold border border-red-900/30 hover:bg-red-600/40">STOP</button>
                    </div>
                </div>`;
            });
        }

        async function editUserTime(name) {
            const m = prompt(`Add New Minutes for ${name}:`);
            if(!m) return;
            const pass = document.getElementById('adm-pw').value;
            await fetch('/api/admin', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({action: 'update_user_time', user: name, mins: m, password: pass}) });
            adminAction(); msg("TIME UPDATED!");
        }

        async function stopUserBot(name) {
            if(!confirm(`Force Stop bot for ${name}?`)) return;
            const pass = document.getElementById('adm-pw').value;
            await fetch('/api/admin', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({action: 'stop_user', user: name, password: pass}) });
            adminAction(); msg("BOT TERMINATED!");
        }

        async function saveGlobal() {
            const dur = document.getElementById('new-duration').value;
            const pass = document.getElementById('adm-pw').value;
            if(!dur) return msg("ENTER DURATION!");
            try {
                const res = await fetch('/api/admin', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({action: 'save_global', duration: dur, password: pass}) });
                const d = await res.json();
                if(d.status === 'success') {
                   msg("GLOBAL DURATION UPDATED!");
                   document.getElementById('current-global-time').innerText = dur;
                   document.getElementById('new-duration').value = "";
                }
            } catch(e) { msg("SAVE FAILED"); }
        }

        async function fetchFriendList() {
            const u = localStorage.getItem('bot_uid'), p = localStorage.getItem('bot_pw'), box = document.getElementById('nickname-list');
            if(!u || !p) return msg("ACCOUNT NOT CONFIGURED!");
            box.innerHTML = "<p class='col-span-2 text-center text-[9px] text-gray-500 animate-pulse'>LOADING...</p>";
            try {
                const r = await fetch(`https://danger-friend-manager.vercel.app/get_friends_list?uid=${u}&password=${p}`);
                const d = await r.json(); box.innerHTML = "";
                if(d.friends && d.friends.length > 0) d.friends.forEach(f => box.innerHTML += `<div class='bg-white/5 p-2 rounded text-[9px] truncate border border-white/5'>üë§ ${f.nickname}</div>`);
                else box.innerHTML = "<p class='col-span-2 text-center text-gray-600 py-2'>Empty List</p>";
            } catch(e) { msg("FETCH FAILED"); box.innerHTML = ""; }
        }

        async function checkLiveStatus() {
            const name = localStorage.getItem('bot_name'); if(!name) return;
            try {
                const res = await fetch('/api/check_status', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({name}) });
                const d = await res.json(); if(d.running) updateStat(true, d.rem_sec);
            } catch(e) {}
        }

        window.onload = () => {
            document.getElementById('name').value = localStorage.getItem('bot_name') || "";
            document.getElementById('uid').value = localStorage.getItem('bot_uid') || "";
            document.getElementById('pw').value = localStorage.getItem('bot_pw') || "";
            checkLiveStatus();
        };

        socket.on('new_log', (m) => {
            if (m.user === localStorage.getItem('bot_name')) {
                const l = document.getElementById('logs'), d = document.createElement('div');
                d.className = "mb-1 text-gray-400 border-l-2 border-orange-500/30 pl-2 leading-tight"; d.innerText = `[${new Date().toLocaleTimeString()}] ${m.data}`;
                l.appendChild(d); l.scrollTop = l.scrollHeight;
            }
        });

        socket.on('time_sync', (data) => {
            if (data.user === localStorage.getItem('bot_name')) startTimer(data.rem_sec);
        });
    </script>
</body>
</html>
